{"version":3,"sources":["test/test-presets-api.test.js"],"names":["request","require","logger","nconf","describe","apiServer","testBackend","stationManager","beforeEach","done","defaults","port","hilbert_cli_path","test","scriptConcurrency","max_log_length","log_directory","log_level","mkls_poll_delay","mkls_cmd","long_poll_timeout","db_path","addStation","id","name","type","default_app","possible_apps","getHilbertCLIConnector","getMKLivestatusConnector","init","then","startStations","pollMKLivestatus","httpAPIServer","getServer","it","get","set","expect","response","body","should","deepEqual","presets","post","send","stationApps","station_a","station_b","put","delete","station_x","getStationByID","state","equal","switching_app"],"mappings":"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","file":"test/test-presets-api.test.js","sourcesContent":["import StationManager from '../lib/station-manager';\nimport HttpAPIServer from '../lib/http-api-server';\nimport TestBackend from '../lib/test-backend';\n\nconst request = require('supertest');\nconst logger = require('winston');\nconst nconf = require('nconf');\n\ndescribe('Presets HTTP API', () => {\n  let apiServer = null;\n  let testBackend = null;\n  let stationManager = null;\n\n  beforeEach((done) => {\n    nconf.defaults({\n      port: '3000',\n      hilbert_cli_path: '../work/dockapp',\n      test: true,\n      scriptConcurrency: 20,\n      max_log_length: 100,\n      log_directory: './log',\n      log_level: 'info', // error, warn, info, verbose, debug, silly\n      mkls_poll_delay: 1000,\n      mkls_cmd: 'nc localhost 6557',\n      long_poll_timeout: 0,\n      db_path: '',\n    });\n\n    testBackend = new TestBackend(nconf, logger);\n    testBackend.addStation({\n      id: 'station_a',\n      name: 'Station A',\n      type: 'type_a',\n      default_app: 'app_a',\n      possible_apps: ['app_a', 'app_b', 'app_c', 'app_d'],\n    });\n    testBackend.addStation({\n      id: 'station_b',\n      name: 'Station B',\n      type: 'type_a',\n      default_app: 'app_b',\n      possible_apps: ['app_a', 'app_b', 'app_c', 'app_d'],\n    });\n    testBackend.addStation({\n      id: 'station_c',\n      name: 'Station C',\n      type: 'type_a',\n      default_app: 'app_c',\n      possible_apps: ['app_a', 'app_b', 'app_c', 'app_d'],\n    });\n    stationManager = new StationManager(\n      nconf,\n      logger,\n      testBackend.getHilbertCLIConnector(),\n      testBackend.getMKLivestatusConnector()\n    );\n\n    stationManager.init()\n    .then(() => stationManager.startStations(['station_a', 'station_b', 'station_c']))\n    .then(() => stationManager.pollMKLivestatus())\n    .then(() => stationManager.pollMKLivestatus())\n    .then(() => {\n      const httpAPIServer = new HttpAPIServer(stationManager, nconf, logger);\n      httpAPIServer.init().then(() => {\n        apiServer = httpAPIServer.getServer();\n        done();\n      });\n    });\n  });\n\n  describe('GET /presets without presets', () => {\n    it('responds with JSON', () => request(apiServer)\n      .get('/presets')\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual({ presets: [] });\n      })\n    );\n  });\n\n  describe('GET /presets with presets', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .get('/presets')\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual({ presets: [\n          {\n            id: 1,\n            name: 'My Preset',\n          },\n        ] });\n      })\n    );\n  });\n\n  describe('GET /preset/:id', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails with no arguments', (done) => {\n      request(apiServer)\n        .get('/preset')\n        .set('Accept', 'application/json')\n        .expect(404, done);\n    });\n\n    it('fails with a non numeric id', () => request(apiServer)\n      .get('/preset/xxxx')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with id = 0', () => request(apiServer)\n      .get('/preset/0')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a negative id', () => request(apiServer)\n      .get('/preset/-1')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a very large id', () => request(apiServer)\n      .get('/preset/99999999999')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the requested station does not exist', (done) => {\n      request(apiServer)\n        .get('/preset/777')\n        .set('Accept', 'application/json')\n        .expect(404, done);\n    });\n\n    it('responds with JSON', () => request(apiServer)\n      .get('/preset/1')\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual(\n          {\n            id: 1,\n            name: 'My Preset',\n            stationApps: {\n              station_a: 'app_a',\n            },\n          }\n        );\n      })\n    );\n  });\n\n  describe('POST /preset', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset 2',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual(\n          {\n            id: 2,\n            name: 'My Preset 2',\n            stationApps: {\n              station_a: 'app_a',\n            },\n          }\n        );\n      })\n    );\n\n    it('fails when adding a preset with an existing name', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset does not have a name', () => request(apiServer)\n      .post('/preset')\n      .send({\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset has an empty name', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: '',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset has a name that is too long', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: '123456789012345678901234567890123456789012345678901',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset does not have stationApps', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset 2',\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if stationApps is the wrong format', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset 2',\n        stationApps: {\n          station_a: 'an_app',\n          station_b: [1, 2, 3],\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n  });\n\n  describe('PUT /preset/:id', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset 2',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails with no arguments', () => request(apiServer)\n      .put('/preset')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('fails with a non numeric id', () => request(apiServer)\n      .put('/preset/xxxx')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with id = 0', () => request(apiServer)\n      .put('/preset/0')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a negative id', () => request(apiServer)\n      .put('/preset/-1')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a very large id', () => request(apiServer)\n      .put('/preset/99999999999')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset does not exist', () => request(apiServer)\n      .put('/preset/8')\n      .send({\n        name: 'My Preset B',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('fails if the name already exists', () => request(apiServer)\n      .put('/preset/2')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset has an empty name', () => request(apiServer)\n      .put('/preset/1')\n      .send({\n        name: '',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset has a name that is too long', () => request(apiServer)\n      .put('/preset/1')\n      .send({\n        name: '123456789012345678901234567890123456789012345678901',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if stationApps is the wrong format', () => request(apiServer)\n      .put('/preset/1')\n      .send({\n        name: 'My Preset 2',\n        stationApps: {\n          station_a: 'an_app',\n          station_b: [1, 2, 3],\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .put('/preset/1')\n      .send({\n        name: 'My Preset 1',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n  });\n\n  describe('DELETE /preset/:id', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_d',\n          station_b: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails with no arguments', () => request(apiServer)\n      .delete('/preset')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('fails with a non numeric id', () => request(apiServer)\n      .delete('/preset/xxxx')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with id = 0', () => request(apiServer)\n      .delete('/preset/0')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a negative id', () => request(apiServer)\n      .delete('/preset/-1')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a very large id', () => request(apiServer)\n      .delete('/preset/99999999999')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset does not exist', () => request(apiServer)\n      .delete('/preset/8')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .delete('/preset/1')\n      .set('Accept', 'application/json')\n      .expect(200)\n    );\n  });\n\n  describe('POST /preset/:id/activate', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_d',\n          station_b: 'app_a',\n          station_x: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails with a non numeric id', () => request(apiServer)\n      .post('/preset/xxxx/activate')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with id = 0', () => request(apiServer)\n      .post('/preset/0/activate')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a negative id', () => request(apiServer)\n      .post('/preset/-1/activate')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails with a very large id', () => request(apiServer)\n      .post('/preset/99999999999/activate')\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('fails if the preset does not exist', () => request(apiServer)\n      .post('/preset/8/activate')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .post('/preset/1/activate')\n      .set('Accept', 'application/json')\n      .expect(200)\n      .then(() => {\n        stationManager.getStationByID('station_a').state.should.equal('switching_app');\n        stationManager.getStationByID('station_a').switching_app.should.equal('app_d');\n        stationManager.getStationByID('station_b').state.should.equal('switching_app');\n        stationManager.getStationByID('station_b').switching_app.should.equal('app_a');\n        stationManager.getStationByID('station_c').state.should.equal('on');\n      })\n    );\n  });\n});\n"],"sourceRoot":"/source/"}