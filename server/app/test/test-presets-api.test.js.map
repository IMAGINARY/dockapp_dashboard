{"version":3,"sources":["test/test-presets-api.test.js"],"names":["request","require","logger","nconf","describe","apiServer","testBackend","stationManager","beforeEach","done","defaults","port","hilbert_cli_path","test","scriptConcurrency","max_log_length","log_directory","log_level","mkls_poll_delay","mkls_cmd","long_poll_timeout","db_path","addStation","id","name","type","default_app","possible_apps","getHilbertCLIConnector","getMKLivestatusConnector","init","then","startStations","pollMKLivestatus","httpAPIServer","getServer","it","get","set","expect","response","body","should","deepEqual","presets","post","send","stationApps","station_a","put","station_b","delete","station_x","getStationByID","state","equal","switching_app"],"mappings":"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","file":"test/test-presets-api.test.js","sourcesContent":["import StationManager from '../lib/station-manager';\nimport HttpAPIServer from '../lib/http-api-server';\nimport TestBackend from '../lib/test-backend';\n\nconst request = require('supertest');\nconst logger = require('winston');\nconst nconf = require('nconf');\n\ndescribe('Presets HTTP API', () => {\n  let apiServer = null;\n  let testBackend = null;\n  let stationManager = null;\n\n  beforeEach((done) => {\n    nconf.defaults({\n      port: '3000',\n      hilbert_cli_path: '../work/dockapp',\n      test: true,\n      scriptConcurrency: 20,\n      max_log_length: 100,\n      log_directory: './log',\n      log_level: 'info', // error, warn, info, verbose, debug, silly\n      mkls_poll_delay: 1000,\n      mkls_cmd: 'nc localhost 6557',\n      long_poll_timeout: 0,\n      db_path: '',\n    });\n\n    testBackend = new TestBackend(nconf, logger);\n    testBackend.addStation({\n      id: 'station_a',\n      name: 'Station A',\n      type: 'type_a',\n      default_app: 'app_a',\n      possible_apps: ['app_a', 'app_b', 'app_c', 'app_d'],\n    });\n    testBackend.addStation({\n      id: 'station_b',\n      name: 'Station B',\n      type: 'type_a',\n      default_app: 'app_b',\n      possible_apps: ['app_a', 'app_b', 'app_c', 'app_d'],\n    });\n    testBackend.addStation({\n      id: 'station_c',\n      name: 'Station C',\n      type: 'type_a',\n      default_app: 'app_c',\n      possible_apps: ['app_a', 'app_b', 'app_c', 'app_d'],\n    });\n    stationManager = new StationManager(\n      nconf,\n      logger,\n      testBackend.getHilbertCLIConnector(),\n      testBackend.getMKLivestatusConnector()\n    );\n\n    stationManager.init()\n    .then(() => stationManager.startStations(['station_a', 'station_b', 'station_c']))\n    .then(() => stationManager.pollMKLivestatus())\n    .then(() => stationManager.pollMKLivestatus())\n    .then(() => {\n      const httpAPIServer = new HttpAPIServer(stationManager, nconf, logger);\n      httpAPIServer.init().then(() => {\n        apiServer = httpAPIServer.getServer();\n        done();\n      });\n    });\n  });\n\n  describe('GET /presets without presets', () => {\n    it('responds with JSON', () => request(apiServer)\n      .get('/presets')\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual({ presets: [] });\n      })\n    );\n  });\n\n  describe('GET /presets with presets', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .get('/presets')\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual({ presets: [\n          {\n            id: 1,\n            name: 'My Preset',\n          },\n        ] });\n      })\n    );\n  });\n\n  describe('GET /preset/:id', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails with no arguments', (done) => {\n      request(apiServer)\n        .get('/preset')\n        .set('Accept', 'application/json')\n        .expect(404, done);\n    });\n\n    it('fails if the requested station does not exist', (done) => {\n      request(apiServer)\n        .get('/preset/777')\n        .set('Accept', 'application/json')\n        .expect(404, done);\n    });\n\n    it('responds with JSON', () => request(apiServer)\n      .get('/preset/1')\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual(\n          {\n            id: 1,\n            name: 'My Preset',\n            stationApps: {\n              station_a: 'app_a',\n            },\n          }\n        );\n      })\n    );\n  });\n\n  describe('POST /preset', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset 2',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n      .then((response) => {\n        response.body.should.deepEqual(\n          {\n            id: 2,\n            name: 'My Preset 2',\n            stationApps: {\n              station_a: 'app_a',\n            },\n          }\n        );\n      })\n    );\n\n    it('fails when adding a preset with an existing name', () => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n  });\n\n  describe('PUT /preset/:id', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset 2',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails with no arguments', () => request(apiServer)\n      .put('/preset')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('fails if the preset does not exist', () => request(apiServer)\n      .put('/preset/8')\n      .send({\n        name: 'My Preset B',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('fails if the name already exists', () => request(apiServer)\n      .put('/preset/2')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect(400)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .put('/preset/1')\n      .send({\n        name: 'My Preset 1',\n        stationApps: {\n          station_a: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n  });\n\n  describe('DELETE /preset/:id', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_d',\n          station_b: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails with no arguments', () => request(apiServer)\n      .delete('/preset')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('fails if the preset does not exist', () => request(apiServer)\n      .delete('/preset/8')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .delete('/preset/1')\n      .set('Accept', 'application/json')\n      .expect(200)\n    );\n  });\n\n  describe('POST /preset/:id/activate', () => {\n    beforeEach(() => request(apiServer)\n      .post('/preset')\n      .send({\n        name: 'My Preset',\n        stationApps: {\n          station_a: 'app_d',\n          station_b: 'app_a',\n          station_x: 'app_a',\n        },\n      })\n      .set('Accept', 'application/json')\n      .expect('Content-Type', /json/)\n      .expect(200)\n    );\n\n    it('fails if the preset does not exist', () => request(apiServer)\n      .post('/preset/8/activate')\n      .set('Accept', 'application/json')\n      .expect(404)\n    );\n\n    it('responds with JSON', () => request(apiServer)\n      .post('/preset/1/activate')\n      .set('Accept', 'application/json')\n      .expect(200)\n      .then(() => {\n        stationManager.getStationByID('station_a').state.should.equal('switching_app');\n        stationManager.getStationByID('station_a').switching_app.should.equal('app_d');\n        stationManager.getStationByID('station_b').state.should.equal('switching_app');\n        stationManager.getStationByID('station_b').switching_app.should.equal('app_a');\n        stationManager.getStationByID('station_c').state.should.equal('on');\n      })\n    );\n  });\n});\n"],"sourceRoot":"/source/"}