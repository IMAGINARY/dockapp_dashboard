{"version":3,"sources":["main.js"],"names":["appPackage","require","logger","nconf","testData","env","argv","file","defaults","port","hilbert_cli_path","test","scriptConcurrency","max_log_length","log_directory","log_level","mkls_poll_delay","mkls_cmd","add","transports","File","filename","get","level","handleExceptions","json","process","on","err","error","message","exitCode","info","version","hilbertCLIConnector","mkLivestatusConnector","testBackend","load","getHilbertCLIConnector","getMKLivestatusConnector","stationManager","init","then","server","listen","catch","exit"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,aAAaC,QAAQ,iBAAR,CAAnB;AACA,IAAMC,SAASD,QAAQ,SAAR,CAAf;AACA,IAAME,QAAQF,QAAQ,OAAR,CAAd;;AAEA,IAAMG,WAAWH,QAAQ,sCAAR,CAAjB;;AAEAE,MAAME,GAAN,GAAYC,IAAZ;AACAH,MAAMI,IAAN,CAAW,aAAX;AACAJ,MAAMK,QAAN,CAAe;AACbC,QAAM,MADO;AAEbC,oBAAkB,iBAFL;AAGbC,QAAM,KAHO;AAIbC,qBAAmB,EAJN;AAKbC,kBAAgB,GALH;AAMbC,iBAAe,OANF;AAObC,aAAW,MAPE,EAOM;AACnBC,mBAAiB,IARJ;AASbC,YAAU;AATG,CAAf;;AAYAf,OAAOgB,GAAP,CAAWhB,OAAOiB,UAAP,CAAkBC,IAA7B,EAAmC;AACjCC,YAAalB,MAAMmB,GAAN,CAAU,eAAV,CAAb,oBADiC;AAEjCC,SAAOpB,MAAMmB,GAAN,CAAU,WAAV,CAF0B;AAGjCE,oBAAkB,IAHe;AAIjCC,QAAM;AAJ2B,CAAnC;;AAOAvB,OAAOqB,KAAP,GAAepB,MAAMmB,GAAN,CAAU,WAAV,CAAf;;AAEAI,QAAQC,EAAR,CAAW,mBAAX,EAAgC,UAACC,GAAD,EAAS;AACvC1B,SAAO2B,KAAP,0BAAoCD,IAAIE,OAAxC;AACAJ,UAAQK,QAAR,GAAmB,CAAnB;AACD,CAHD;;AAKA7B,OAAO8B,IAAP,mCAA4ChC,WAAWiC,OAAvD;;AAEA,IAAIC,sBAAsB,IAA1B;AACA,IAAIC,wBAAwB,IAA5B;;AAEA,IAAIhC,MAAMmB,GAAN,CAAU,MAAV,CAAJ,EAAuB;AACrBpB,SAAO8B,IAAP,CAAY,sBAAZ;AACA,MAAMI,cAAc,0BAAgBjC,KAAhB,EAAuBD,MAAvB,CAApB;AACAkC,cAAYC,IAAZ,CAAiBjC,QAAjB;AACA8B,wBAAsBE,YAAYE,sBAAZ,EAAtB;AACAH,0BAAwBC,YAAYG,wBAAZ,EAAxB;AACD,CAND,MAMO;AACLL,wBAAsB,kCAAwB/B,KAAxB,EAA+BD,MAA/B,CAAtB;AACAiC,0BAAwB,oCAA0BhC,KAA1B,EAAiCD,MAAjC,CAAxB;AACD;;AAED,IAAMsC,iBAAiB,6BACrBrC,KADqB,EAErBD,MAFqB,EAGrBgC,mBAHqB,EAIrBC,qBAJqB,CAAvB;;AAOAK,eAAeC,IAAf,GAAsBC,IAAtB,CAA2B,YAAM;AAC/B,MAAMC,SAAS,4BAAkBH,cAAlB,EAAkCtC,MAAlC,CAAf;AACAyC,SAAOC,MAAP,CAAczC,MAAMmB,GAAN,CAAU,MAAV,CAAd;AACD,CAHD,EAGGuB,KAHH,CAGS,UAACjB,GAAD,EAAS;AAChB1B,SAAO2B,KAAP,0CAAoDD,IAAIE,OAAxD;AACAJ,UAAQoB,IAAR,CAAa,CAAb;AACD,CAND","file":"main.js","sourcesContent":["import 'babel-polyfill';\nimport StationManager from './lib/station-manager';\nimport HilbertCLIConnector from './lib/hilbert-cli-connector';\nimport MKLivestatusConnector from './lib/mk-livestatus-connector';\nimport HttpAPIServer from './lib/http-api-server';\nimport TestBackend from './lib/test-backend';\n\nconst appPackage = require('../package.json');\nconst logger = require('winston');\nconst nconf = require('nconf');\n\nconst testData = require('../data/test_mode/test_stations.json');\n\nnconf.env().argv();\nnconf.file('config.json');\nnconf.defaults({\n  port: '3000',\n  hilbert_cli_path: '../work/dockapp',\n  test: false,\n  scriptConcurrency: 20,\n  max_log_length: 100,\n  log_directory: './log',\n  log_level: 'info', // error, warn, info, verbose, debug, silly\n  mkls_poll_delay: 1000,\n  mkls_cmd: 'nc localhost 6557',\n});\n\nlogger.add(logger.transports.File, {\n  filename: `${nconf.get('log_directory')}/hilbert-ui.log`,\n  level: nconf.get('log_level'),\n  handleExceptions: true,\n  json: false,\n});\n\nlogger.level = nconf.get('log_level');\n\nprocess.on('uncaughtException', (err) => {\n  logger.error(`Uncaught exception: ${err.message}. Exiting process.`);\n  process.exitCode = 1;\n});\n\nlogger.info(`Starting hilbert-ui server (v${appPackage.version})`);\n\nlet hilbertCLIConnector = null;\nlet mkLivestatusConnector = null;\n\nif (nconf.get('test')) {\n  logger.info('Running in Test Mode');\n  const testBackend = new TestBackend(nconf, logger);\n  testBackend.load(testData);\n  hilbertCLIConnector = testBackend.getHilbertCLIConnector();\n  mkLivestatusConnector = testBackend.getMKLivestatusConnector();\n} else {\n  hilbertCLIConnector = new HilbertCLIConnector(nconf, logger);\n  mkLivestatusConnector = new MKLivestatusConnector(nconf, logger);\n}\n\nconst stationManager = new StationManager(\n  nconf,\n  logger,\n  hilbertCLIConnector,\n  mkLivestatusConnector\n);\n\nstationManager.init().then(() => {\n  const server = new HttpAPIServer(stationManager, logger);\n  server.listen(nconf.get('port'));\n}).catch((err) => {\n  logger.error(`Error initializing Station Manager: ${err.message}. Exiting process.`);\n  process.exit(1);\n});\n"],"sourceRoot":"/source/"}