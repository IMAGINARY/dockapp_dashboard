{"version":3,"sources":["main.js"],"names":["appPackage","require","logger","nconf","testHilbertCfg","env","argv","file","defaults","port","test","scriptConcurrency","max_notifications","log_directory","log_level","mkls_poll_delay","mkls_cmd","long_poll_timeout","operation_timeout","error_lock_time","db_path","add","transports","File","filename","get","level","handleExceptions","json","process","on","err","error","message","exitCode","info","version","hilbertCLIConnector","mkLivestatusConnector","testBackend","simulateDelays","load","getHilbertCLIConnector","getMKLivestatusConnector","stationManager","server","init","then","listen","catch"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,aAAaC,QAAQ,iBAAR,CAAnB;AACA,IAAMC,SAASD,QAAQ,SAAR,CAAf;AACA,IAAME,QAAQF,QAAQ,OAAR,CAAd;;AAEA,IAAMG,iBAAiBH,QAAQ,4BAAR,CAAvB;;AAEAE,MAAME,GAAN,GAAYC,IAAZ;AACAH,MAAMI,IAAN,CAAW,aAAX;AACAJ,MAAMK,QAAN,CAAe;AACbC,QAAM,MADO;AAEbC,QAAM,KAFO;AAGbC,qBAAmB,EAHN;AAIbC,qBAAmB,GAJN;AAKbC,iBAAe,OALF;AAMbC,aAAW,MANE,EAMM;AACnBC,mBAAiB,IAPJ;AAQbC,YAAU,mBARG;AASbC,qBAAmB,EATN;AAUbC,qBAAmB,GAVN;AAWbC,mBAAiB,EAXJ;AAYbC,WAAS;AAZI,CAAf;;AAeAlB,OAAOmB,GAAP,CAAWnB,OAAOoB,UAAP,CAAkBC,IAA7B,EAAmC;AACjCC,YAAarB,MAAMsB,GAAN,CAAU,eAAV,CAAb,oBADiC;AAEjCC,SAAOvB,MAAMsB,GAAN,CAAU,WAAV,CAF0B;AAGjCE,oBAAkB,IAHe;AAIjCC,QAAM;AAJ2B,CAAnC;;AAOA1B,OAAOwB,KAAP,GAAevB,MAAMsB,GAAN,CAAU,WAAV,CAAf;;AAEAI,QAAQC,EAAR,CAAW,mBAAX,EAAgC,UAACC,GAAD,EAAS;AACvC7B,SAAO8B,KAAP,0BAAoCD,IAAIE,OAAxC;AACAJ,UAAQK,QAAR,GAAmB,CAAnB;AACD,CAHD;;AAKAhC,OAAOiC,IAAP,mCAA4CnC,WAAWoC,OAAvD;;AAEA,IAAIC,sBAAsB,IAA1B;AACA,IAAIC,wBAAwB,IAA5B;;AAEA,IAAInC,MAAMsB,GAAN,CAAU,MAAV,CAAJ,EAAuB;AACrBvB,SAAOiC,IAAP,CAAY,sBAAZ;AACA,MAAMI,cAAc,0BAAgBpC,KAAhB,EAAuBD,MAAvB,CAApB;AACAqC,cAAYC,cAAZ,GAA6B,IAA7B;AACAD,cAAYE,IAAZ,CAAiBrC,cAAjB;AACAiC,wBAAsBE,YAAYG,sBAAZ,EAAtB;AACAJ,0BAAwBC,YAAYI,wBAAZ,EAAxB;AACD,CAPD,MAOO;AACLN,wBAAsB,kCAAwBlC,KAAxB,EAA+BD,MAA/B,CAAtB;AACAoC,0BAAwB,oCAA0BnC,KAA1B,EAAiCD,MAAjC,CAAxB;AACD;;AAED,IAAM0C,iBAAiB,6BACrBzC,KADqB,EAErBD,MAFqB,EAGrBmC,mBAHqB,EAIrBC,qBAJqB,CAAvB;;AAOA,IAAIO,SAAS,IAAb;AACAD,eAAeE,IAAf,GACGC,IADH,CACQ,YAAM;AACVF,WAAS,4BAAkBD,cAAlB,EAAkCzC,KAAlC,EAAyCD,MAAzC,CAAT;AACA,SAAO2C,OAAOC,IAAP,EAAP;AACD,CAJH,EAKGC,IALH,CAKQ,YAAM;AACVF,SAAOG,MAAP,CAAc7C,MAAMsB,GAAN,CAAU,MAAV,CAAd;AACD,CAPH,EAQGwB,KARH,CAQS,UAAClB,GAAD,EAAS;AACd7B,SAAO8B,KAAP,0CAAoDD,IAAIE,OAAxD;AACAJ,UAAQK,QAAR,GAAmB,CAAnB;AACD,CAXH","file":"main.js","sourcesContent":["import 'babel-polyfill';\nimport StationManager from './lib/station-manager';\nimport HilbertCLIConnector from './lib/hilbert-cli-connector';\nimport MKLivestatusConnector from './lib/mk-livestatus-connector';\nimport HttpAPIServer from './lib/http-api-server';\nimport TestBackend from './lib/test-backend/test-backend';\n\nconst appPackage = require('../package.json');\nconst logger = require('winston');\nconst nconf = require('nconf');\n\nconst testHilbertCfg = require('../data/test_mode/cfg.json');\n\nnconf.env().argv();\nnconf.file('config.json');\nnconf.defaults({\n  port: '3000',\n  test: false,\n  scriptConcurrency: 20,\n  max_notifications: 100,\n  log_directory: './log',\n  log_level: 'info', // error, warn, info, verbose, debug, silly\n  mkls_poll_delay: 1000,\n  mkls_cmd: 'nc localhost 6557',\n  long_poll_timeout: 15,\n  operation_timeout: 600,\n  error_lock_time: 30,\n  db_path: '',\n});\n\nlogger.add(logger.transports.File, {\n  filename: `${nconf.get('log_directory')}/hilbert-ui.log`,\n  level: nconf.get('log_level'),\n  handleExceptions: true,\n  json: false,\n});\n\nlogger.level = nconf.get('log_level');\n\nprocess.on('uncaughtException', (err) => {\n  logger.error(`Uncaught exception: ${err.message}. Exiting process.`);\n  process.exitCode = 1;\n});\n\nlogger.info(`Starting hilbert-ui server (v${appPackage.version})`);\n\nlet hilbertCLIConnector = null;\nlet mkLivestatusConnector = null;\n\nif (nconf.get('test')) {\n  logger.info('Running in Test Mode');\n  const testBackend = new TestBackend(nconf, logger);\n  testBackend.simulateDelays = true;\n  testBackend.load(testHilbertCfg);\n  hilbertCLIConnector = testBackend.getHilbertCLIConnector();\n  mkLivestatusConnector = testBackend.getMKLivestatusConnector();\n} else {\n  hilbertCLIConnector = new HilbertCLIConnector(nconf, logger);\n  mkLivestatusConnector = new MKLivestatusConnector(nconf, logger);\n}\n\nconst stationManager = new StationManager(\n  nconf,\n  logger,\n  hilbertCLIConnector,\n  mkLivestatusConnector\n);\n\nlet server = null;\nstationManager.init()\n  .then(() => {\n    server = new HttpAPIServer(stationManager, nconf, logger);\n    return server.init();\n  })\n  .then(() => {\n    server.listen(nconf.get('port'));\n  })\n  .catch((err) => {\n    logger.error(`Error initializing Station Manager: ${err.message}. Exiting process.`);\n    process.exitCode = 2;\n  });\n"],"sourceRoot":"/source/"}